<!DOCTYPE html>
<html lang="en" class="noscroll">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">

    <title>CasualGameSpace</title>
</head>

<body>
    <div id="app" class="hidden">
        <div class="navbar is-link is-fixed-top">
            <div class="container">
                <div class="navbar-brand is-dark">
                    <a class="heroIcon" href="#">
                        <img src="assets/img/logo.png" alt="Logo">
                    </a>
                    <a class="navTitle" href="#">CasualGameSpace</a>

                    <span class="navbar-burger" data-target="navbarMenuHeroC">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                </div>

                <div id="navbarMenuHeroC" class="navbar-menu">
                    <div class="navbar-end">
                        <a class="navbar-item is-active" href="#">
                            Home
                        </a>
                        <div class="navbar-item has-dropdown is-hoverable">
                            <!-- <p id="username" class="navbar-item" data-action="open_profile">Loading...</p> -->
                            <!-- <span class="avatar-small" data-action="open_profile"></span> -->

                            <!-- <div class="navbar-dropdown">
                                <a data-action="open_profile" class="navbar-item is-dropdown">
                                    Profile
                                </a>
                                <a href="#settings" class="navbar-item is-dropdown">
                                    Settings
                                </a>
                                <hr class="navbar-divider">
                                <a href="/logout" class="navbar-item is-dropdown">
                                    Logout
                                </a>
                            </div> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="hero is-link is-halfheight">
            <div class="hero-body">
                <div class="container has-text-centered">
                    <div class="game-categories">
                        <h2 class="category-title">Game Categories</h2>
                        <div class="categories-grid">
                            <div class="category-card" data-category="all" onclick="filterGames('all')">
                                <div class="category-icon">üéÆ</div>
                                <div class="category-name">All Games</div>
                            </div>
                            <div class="category-card" data-category="Action" onclick="filterGames('Action')">
                                <div class="category-icon">‚öîÔ∏è</div>
                                <div class="category-name">Action</div>
                            </div>
                            <div class="category-card" data-category="Puzzle" onclick="filterGames('Puzzle')">
                                <div class="category-icon">üß©</div>
                                <div class="category-name">Puzzle</div>
                            </div>
                            <div class="category-card" data-category="Racing" onclick="filterGames('Racing')">
                                <div class="category-icon">üèéÔ∏è</div>
                                <div class="category-name">Racing</div>
                            </div>
                            <div class="category-card" data-category="Adventure" onclick="filterGames('Adventure')">
                                <div class="category-icon">üó∫Ô∏è</div>
                                <div class="category-name">Adventure</div>
                            </div>
                            <div class="category-card" data-category="Arcade" onclick="filterGames('Arcade')">
                                <div class="category-icon">üïπÔ∏è</div>
                                <div class="category-name">Arcade</div>
                            </div>
                            <div class="category-card" data-category="Strategy" onclick="filterGames('Strategy')">
                                <div class="category-icon">üß†</div>
                                <div class="category-name">Strategy</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="database_nav">
            <div class="search">
                <i class="fa-solid fa-magnifying-glass"></i>

                <input class="input is-link is-rounded searchBar" data-func="search" placeholder="Search">
            </div>

            <div class="control has-icons-left sort">
                <div class="select is-link is-rounded sortSelect">
                    <select>
                        <option selected>Default</option>
                        <option disabled>Game Type</option>
                        <option disabled>A-Z</option>
                        <option disabled>Z-A</option>
                    </select>
                </div>

                <span class="icon is-left">
                    <i class="fa-solid fa-arrow-up-short-wide"></i>
                </span>
            </div>
        </div>

        <!-- ÊêúÁ¥¢ÈîôËØØÊèêÁ§∫ -->
        <div class="searchErr hidden">
            <h1>¬Ø\(¬∞_o)/¬Ø</h1>
            <br>
            <p>Oops, we couldn't find the game you were looking for. </p>
        </div>

        <div class="games"></div>
        
        <!-- Ê∑ªÂä†ÂàÜÈ°µÊéß‰ª∂ -->
        <div class="pagination-container"></div>
        
        <!-- È°µÈù¢‰∏ª‰Ωì‰∏≠Èù†‰∏ä‰ΩçÁΩÆ -->
        <!-- ÊóßËäÇÁÇπÔºöËØ∑Âà†Èô§Ëøô‰∏ÄË°å -->
        <!-- <div class="gameFrame hidden"></div> -->
        
        <!-- ‰øùÁïô‰∏ãÈù¢Ëøô‰∏™ËØ¶ÊÉÖÂÆπÂô®Ôºà‰Ω†Â∑≤ÁªèÊúâ‰∫ÜÔºâ -->
        <section id="game-player" class="hidden">
            <h2 id="game-title"></h2>
            <div class="gameFrame"></div>
        </section>

        <footer>
            <div class="title">
                <h1>CasualGameSpace</h1><img src="assets/img/logo.png">
            </div>

            <!-- <div class="socials">
                <a href="https://discord.gg/RXBbxQ4wuJ" target="_blank" rel="noopener noreferrer"
                    title="EmberNetwork Discord">
                    <i class="fa-brands fa-discord"></i>
                </a>

                <a href="https://github.com/EmberNetwork/GameHub" target="_blank" rel="noopener noreferrer"
                    title="Our Github">
                    <i class="fa-brands fa-github"></i>
                </a>

                <a href="mailto:support@gamehub.dev" target="_blank" title="Contact Email">
                    <i class="fa-solid fa-envelope"></i>
                </a>

                <a href="http://status.embernet.work/status/gamehub" target="_blank" rel="noopener noreferrer"
                    title="Server Status">
                    <i class="fa-solid fa-square-rss"></i>
                </a>
            </div> -->

            <br>

            <p>¬©2025 CasualGameSpace. All rights reserved.</p>
        </footer>
    </div>

    <div id="loader">
        <div></div>
        <div></div>
        <div></div>
    </div>

    <script src="assets/js/main.js" type="module"></script>
    <script src="assets/js/gamemanger.js" type="module"></script>
    <!-- Ê≥®ÈáäÊéâ profile.js ÁöÑÂºïÁî® -->
    <!-- <script src="assets/js/profile.js" type="module"></script> -->
</body>

    <script>
    // ÁîüÊàêÊ∏∏Êàè slugÔºöÂ∞èÂÜô + ÂéªÈùûÂ≠óÊØçÊï∞Â≠ó + ÂéªÁ©∫ÁôΩ
    function generateGameSlug(name) {
        return String(name || '')
            .toLowerCase()
            .replace(/[^a-z0-9\s]/g, '')
            .replace(/\s+/g, '')
            .trim();
    }

    // Áªü‰∏ÄÁ´ôÂÜÖÂØºËà™ÔºöÂßãÁªà‰ΩøÁî® hash(#/xxx) Ë∑ØÁî±ÔºåÈÅøÂÖç‰ªª‰ΩïÊúçÂä°Á´Ø‰æùËµñ
    function navigateTo(newUrl, event) {
        if (event && typeof event.preventDefault === 'function') event.preventDefault();
        const slug = String(newUrl || '').replace(/^#?\/?/, ''); // ÂéªÊéâÂâçÂØº / Êàñ #
        location.hash = `#/${slug}`;
    }

    // ÂÖ®Â±ÄÊã¶Êà™Á´ôÂÜÖÈìæÊé•ÔºàÂØπÂ§ñÈìæ„ÄÅÊñ∞Á™óÂè£„ÄÅ‰∏ãËΩΩ‰∏çÊã¶Êà™ÔºâÔºåÊîπÂÜô‰∏∫ hash Ë∑ØÁî±
    document.addEventListener('click', (e) => {
        const a = e.target.closest('a[href]');
        if (!a) return;
        const href = a.getAttribute('href');
        if (!href) return;
        if (href.startsWith('#')) return; // Â∑≤ÁªèÊòØÈîöÁÇπ/ÂìàÂ∏å
        if (a.target === '_blank' || a.hasAttribute('download')) return;
        const url = new URL(href, window.location.href);
        if (url.origin !== window.location.origin) return;
        e.preventDefault();
        const path = url.pathname.replace(/^\/+/, '');
        location.hash = `#/${path}`;
    });

    // Âä®ÊÄÅÊî∂ÈõÜÊâÄÊúâÂàÜÁ±ªÔºà‰ªé window.allGames ÊèêÂèñÔºâ
    function getAllCategories() {
        const games = Array.isArray(window.allGames) ? window.allGames : [];
        const set = new Set();
        for (const g of games) {
            if (!g) continue;
            if (Array.isArray(g.category)) g.category.forEach(c => c && set.add(c));
            else if (g.category) set.add(g.category);
        }
        return Array.from(set);
    }

    // Â∞ÜË∑ØÂæÑËß£Êûê‰∏∫ÂàÜÁ±ªÂêçÔºàÂøΩÁï•Â§ßÂ∞èÂÜôÔºâ
    function resolveCategoryFromPath(path) {
        const name = decodeURIComponent(String(path || '').replace(/^\//, ''));
        const cats = getAllCategories();
        return cats.find(c => c.toLowerCase() === name.toLowerCase());
    }

    function handleRoute() {
        // Êú¨Âú∞ÈùôÊÄÅÁéØÂ¢ÉÂèØÁî® hash ‰ΩúÂÖúÂ∫ïÔºõÈÉ®ÁΩ≤Âêé‰ΩøÁî® pathnameÔºàÂπ≤ÂáÄË∑ØÂæÑÔºâ
        const path = location.hash.startsWith('#/') ? location.hash.slice(1) : location.pathname;
    
        // ÈöêËóèÂå∫ÂüüÔºàÈªòËÆ§ÂÖ®ÈÉ®ÂÖàÈöêËóèÔºâ
        const gamesEl = document.querySelector('.games');
        const playerEl = document.getElementById('game-player');
        const categoriesEl = document.querySelector('.game-categories'); // ÂàÜÁ±ªÂç°ÁâáÂÆπÂô®
        const searchBoxEl = document.querySelector('.search');           // ÊêúÁ¥¢Ê°ÜÂÆπÂô®
        // Êñ∞Â¢ûÔºö‰∏ãÊãâÁ≠õÈÄâ‰∏éÂàÜÈ°µÂÆπÂô®
        const sortEl = document.querySelector('.sort');
        const sortSelectEl = document.querySelector('.sortSelect');
        const paginationEl = document.querySelector('.pagination-container');
        // Êñ∞Â¢ûÔºöÊï¥‰∏™ hero Âå∫ÂùóÔºàÂ§ñÂ±ÇÂÆπÂô®Ôºâ
        const heroEl = document.querySelector('.hero');
        
        if (gamesEl) gamesEl.classList.add('hidden');
        if (playerEl) playerEl.classList.add('hidden');
        if (categoriesEl) categoriesEl.classList.add('hidden');
        if (searchBoxEl) searchBoxEl.classList.add('hidden');
        if (sortEl) sortEl.classList.add('hidden');
        if (sortSelectEl) sortSelectEl.classList.add('hidden');
        if (paginationEl) paginationEl.classList.add('hidden');
        // Êñ∞Â¢ûÔºöÈªòËÆ§‰πüÈöêËóè heroÔºåÈÅøÂÖçÂç†‰Ωç
        if (heroEl) heroEl.classList.add('hidden');
    
        // È¶ñÈ°µ
        if (path === '/' || path === '') {
            if (gamesEl) gamesEl.classList.remove('hidden');
            if (categoriesEl) categoriesEl.classList.remove('hidden');
            if (searchBoxEl) searchBoxEl.classList.remove('hidden');
            if (sortEl) sortEl.classList.remove('hidden');
            if (sortSelectEl) sortSelectEl.classList.remove('hidden');
            if (paginationEl) paginationEl.classList.remove('hidden');
            // Êñ∞Â¢ûÔºöÈ¶ñÈ°µÊòæÁ§∫ hero
            if (heroEl) heroEl.classList.remove('hidden');
    
            document.title = 'CasualGameSpace';
            return;
        }
    
        // ÂàÜÁ±ªÈ°µÔºà‰ºòÂÖàÂåπÈÖçÔºâ
        const resolvedCategory = resolveCategoryFromPath(path);
        if (resolvedCategory) {
            if (gamesEl) gamesEl.classList.remove('hidden');
            if (categoriesEl) categoriesEl.classList.remove('hidden');
            if (searchBoxEl) searchBoxEl.classList.remove('hidden');
            if (sortEl) sortEl.classList.remove('hidden');
            if (sortSelectEl) sortSelectEl.classList.remove('hidden');
            if (paginationEl) paginationEl.classList.remove('hidden');
            // Êñ∞Â¢ûÔºöÂàÜÁ±ªÈ°µÊòæÁ§∫ hero
            if (heroEl) heroEl.classList.remove('hidden');
    
            if (typeof window.filterGames === 'function') {
                window.filterGames(resolvedCategory);
            }
            document.title = `Category - ${resolvedCategory} - CasualGameSpace`;
            return;
        }
    
        // Ê∏∏ÊàèËØ¶ÊÉÖÈ°µÔºàÂàÜÁ±ªÂç°Áâá„ÄÅÊêúÁ¥¢Ê°Ü„ÄÅÁ≠õÈÄâ„ÄÅÂàÜÈ°µ„ÄÅhero ÈÉΩ‰øùÊåÅÈöêËóèÔºâ
        const gameName = decodeURIComponent(String(path || '').replace(/^\//, ''));
        window.isDetailView = true;
        if (paginationEl) {
            paginationEl.style.display = 'none';
            paginationEl.innerHTML = '';
        }
        loadGameByName(gameName);
    }

    function loadGameByName(gameName) {
        // Á≠âÂæÖ window.allGames Ê≥®ÂÖ•
        if (!Array.isArray(window.allGames) || window.allGames.length === 0) {
            setTimeout(() => loadGameByName(gameName), 100);
            return;
        }

        // Êü•ÊâæÊ∏∏ÊàèÔºàÊîØÊåÅ slug ÊàñÂéüÂßãÂêçÁß∞Ôºâ
        const game = window.allGames.find(g => {
            const gameSlug = generateGameSlug(g?.name);
            return gameSlug === gameName || g?.name === gameName;
        });

        if (game) {
            const gamePlayer = document.getElementById('game-player');
            const gameTitle = document.getElementById('game-title');
            // Âè™‰ΩøÁî®ËØ¶ÊÉÖÂÆπÂô®ÈáåÁöÑ .gameFrameÔºåÈÅøÂÖçËØØÈÄâÂà∞È°µÈù¢‰∏äÂÖ∂‰ªñÂêåÂêçËäÇÁÇπ
            const gameFrame = document.querySelector('#game-player .gameFrame');

            if (gamePlayer) gamePlayer.classList.remove('hidden');
            if (gameTitle) gameTitle.textContent = game.name;
            document.title = `${game.name} - CasualGameSpace`;

            if (gameFrame) {
                gameFrame.innerHTML = '';
                if (game.use === 'redirect') {
                    const iframe = document.createElement('iframe');
                    iframe.src = game.url;
                    iframe.setAttribute('frameborder', '0');
                    iframe.allowFullscreen = true;
                    iframe.style.width = '100%';
                    iframe.style.height = '80vh';
                    iframe.style.border = '0';
                    gameFrame.appendChild(iframe);
                }
            }
        } else {
            navigateTo('/');
        }
    }

    // ÂâçËøõ/ÂêéÈÄÄÔºà‰øùÁïô popstate ‰ª•ÂÖºÂÆπÂéÜÂè≤‰ª£Á†ÅÔºâÔºåÊñ∞Â¢û hashchange ‰ª•ÊîØÊåÅÁ∫ØÂâçÁ´Ø hash Ë∑ØÁî±
    window.addEventListener('popstate', handleRoute);
    window.addEventListener('hashchange', handleRoute);

    // DOMContentLoadedÔºöÁ≠âÊï∞ÊçÆÂ∞±Áª™ÂêéËß¶ÂèëÈ¶ñËΩÆË∑ØÁî±
    document.addEventListener('DOMContentLoaded', () => {
        const app = document.getElementById('app');
        if (app) app.classList.remove('hidden');

        const waitDataReady = () => {
            if (Array.isArray(window.allGames) && window.allGames.length > 0) {
                handleRoute();
            } else {
                setTimeout(waitDataReady, 100);
            }
        };
        waitDataReady();
    });

    // Êö¥Èú≤Âà∞ÂÖ®Â±ÄÔºà‰æõÂÖ∂ÂÆÉËÑöÊú¨‰ΩøÁî®Ôºâ
    window.navigateTo = navigateTo;
    window.handleRoute = handleRoute;
    window.generateGameSlug = generateGameSlug;
    </script>
</body>